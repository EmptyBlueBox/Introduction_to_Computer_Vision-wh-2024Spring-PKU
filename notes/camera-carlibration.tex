\section{Camera Calibration}
我们前面已经知道,从$P_w \to P^\prime$的坐标变换是
\begin{equation}
	\bm P^\prime = \bd M \bm P_w = \bd K
	\begin{bmatrix}
		\bd R & \bd T
	\end{bmatrix} \bm P_w
\end{equation}

其中
\begin{equation}
	\bd{M}=\left(\begin{array}{cc}
		\alpha \boldsymbol{r}_{1}^{T}-\alpha \cot \theta \boldsymbol{r}_{2}^{T}+u_{0} \boldsymbol{r}_{3}^{T} & \alpha t_{x}-\alpha \cot \theta t_{y}+u_{0} t_{z} \\
		\frac{\beta}{\sin \theta} \boldsymbol{r}_{2}^{T}+v_{0} \boldsymbol{r}_{3}^{T} & \frac{\beta}{\sin \theta} t_{y}+v_{0} t_{z} \\
		\boldsymbol{r}_{3}^{T} & t_{z}
	\end{array}\right)
\end{equation}

那么什么是calibration problem呢?如果我们已知世界坐标$P_1, \cdots, P_n$(形式为$[O_w, i_w, j_w, k_w]$)和对应的图像坐标$p_1,\cdots, p_n$.我们的目标是通过这些已知数据,获得intrinsic and extrinsic parameters.这个问题的意义,比如我们希望从图像运动获取实际运动.

问题有11个自由度:5(in)+3(ex-r)+3(ex-t) = 11.需要11个方程,6个点.

对每个$p_i(u_i, v_i)$,我们有
\begin{equation}
	\begin{array}{l}
		\mathrm{u}_{\mathrm{i}}=\frac{\mathbf{m}_{1} \mathrm{P}_{\mathrm{i}}}{\mathbf{m}_{3} \mathrm{P}_{\mathrm{i}}} \rightarrow \mathrm{u}_{\mathrm{i}}\left(\mathbf{m}_{3} \mathrm{P}_{\mathrm{i}}\right)=\mathbf{m}_{1} \mathrm{P}_{\mathrm{i}} \rightarrow \mathrm{u}_{i}\left(\mathbf{m}_{3} \mathrm{P}_{i}\right)-\mathbf{m}_{1} \mathrm{P}_{i}=0 \\
		\mathrm{v}_{\mathrm{i}}=\frac{\mathbf{m}_{2} \mathrm{P}_{\mathrm{i}}}{\mathbf{m}_{3} \mathrm{P}_{\mathrm{i}}} \rightarrow \mathrm{v}_{\mathrm{i}}\left(\mathbf{m}_{3} \mathrm{P}_{\mathrm{i}}\right)=\mathbf{m}_{2} \mathrm{P}_{\mathrm{i}} \rightarrow \mathrm{v}_{i}\left(\mathbf{m}_{3} \mathrm{P}_{i}\right)-\mathbf{m}_{2} \mathrm{P}_{i}=0
	\end{array}
\end{equation}

这样我们可以列出方程组:
\begin{equation}
	\left\{\begin{array}{c}
		u_{1}\left(\mathbf{m}_{3} P_{1}\right)-\mathbf{m}_{1} P_{1}=0 \\
		v_{1}\left(\mathbf{m}_{3} P_{1}\right)-\mathbf{m}_{2} P_{1}=0 \\
		\vdots \\
		u_{i}\left(\mathbf{m}_{3} P_{i}\right)-\mathbf{m}_{1} P_{i}=0 \\
		v_{i}\left(\mathbf{m}_{3} P_{i}\right)-\mathbf{m}_{2} P_{i}=0 \\
		\vdots \\
		u_{n}\left(\mathbf{m}_{3} P_{n}\right)-\mathbf{m}_{1} P_{n}=0 \\
		v_{n}\left(\mathbf{m}_{3} P_{n}\right)-\mathbf{m}_{2} P_{n}=0
	\end{array}\right.
\end{equation}

将$m$展开,获得方程组:
\begin{equation}
	\bd P \bm m = \bm 0
\end{equation}
其中
\begin{equation}
	\mathbf{P}\xlongequal{\operatorname{def}}\left(\begin{array}{ccc}
		\mathbf{P}_{1}^{T} & \mathbf{0}^{T} & -u_{1} \mathbf{P}_{1}^{T} \\
		\mathbf{0}^{T} & \mathbf{P}_{1}^{T} & -v_{1} \mathbf{P}_{1}^{T} \\
		& \vdots & \\
		\mathbf{P}_{\mathrm{n}}^{T} & \mathbf{0}^{T} & -u_{n} \mathbf{P}_{\mathrm{n}}^{T} \\
		\mathbf{0}^{T} & \mathbf{P}_{\mathrm{n}}^{T} & -v_{n} \mathbf{P}_{\mathrm{n}}^{T}
	\end{array}\right)
\end{equation}

以及
\begin{equation}
	\boldsymbol{m}=\left(\begin{array}{c}
		\mathbf{m}_{1}^{\mathrm{T}} \\
		\mathbf{m}_{2}^{\mathrm{T}} \\
		\mathbf{m}_{3}^{\mathrm{T}}
	\end{array}\right)
\end{equation}

但是这个问题过定,且有平凡解.我们先对$\bm m$添加一个constrain:$\norm{m} = 1$.随后用SVD求解如下优化问题:
\begin{equation}
	\begin{split}
		\text{minimize } & \norm{\bd P \bm m}^2
		\\
		\st & \norm{m} = 1
	\end{split}
\end{equation}

进行SVD获得最小的特征向量,即为解.

此时还没有结束,我们需要定出收缩因子.假定
\begin{equation}
	\mathcal{M}=\left(\begin{array}{cc}
		\alpha \boldsymbol{r}_{1}^{T}-\alpha \cot \theta \boldsymbol{r}_{2}^{T}+u_{0} \boldsymbol{r}_{3}^{T} & \alpha t_{x}-\alpha \cot \theta t_{y}+u_{0} t_{z} \\
		\frac{\beta}{\sin \theta} \boldsymbol{r}_{2}^{T}+v_{0} \boldsymbol{r}_{3}^{T} & \frac{\beta}{\sin \theta} t_{y}+v_{0} t_{z} \\
		\boldsymbol{r}_{3}^{T} & t_{z}
	\end{array}\right) \rho
\end{equation}

	此时我们发现$M$第三行可以直接定出$\rho$.于是这样我们就可以获得相应参数.

	实际上,对这个问题的求解就是进行RQ分解\footnote{关于QR分解,请参见附录 \ref{QR Decomposition}}.我们知道RQ分解就是将一个矩阵$\bd A$分解为
\begin{equation}
	\bd A =  \bd R \bd Q
\end{equation}
其中$\bd Q, \bd R$分别是正交矩阵和上三角矩阵.当然,得到的正交矩阵可能是瑕旋转矩阵,即行列式为$-1$的正交矩阵.这种情况我们要检查分解得到的上三角矩阵是否满足相机内参的要求,比如$\sin \theta > 0$,此时将此列和正交矩阵对应行乘以$-1$即可.

当然并不是所有的6个点都可以.不能在同一平面(15:50).对于一般的有畸变的相机,有更复杂的非线性处理方式,可能没有解析解.